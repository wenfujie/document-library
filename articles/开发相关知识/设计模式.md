- [å‰è¨€](#å‰è¨€)
- [1.è§‚å¯Ÿè€…æ¨¡å¼](#1è§‚å¯Ÿè€…æ¨¡å¼)
- [2.å•ä¾‹æ¨¡å¼](#2å•ä¾‹æ¨¡å¼)
- [3.ç­–ç•¥æ¨¡å¼](#3ç­–ç•¥æ¨¡å¼)
- [4.çŠ¶æ€æ¨¡å¼](#4çŠ¶æ€æ¨¡å¼)
- [5.å·¥å‚æ¨¡å¼](#5å·¥å‚æ¨¡å¼)
  - [5.1ç®€å•å·¥å‚æ¨¡å¼](#51ç®€å•å·¥å‚æ¨¡å¼)
  - [5.2æŠ½è±¡å·¥å‚æ¨¡å¼](#52æŠ½è±¡å·¥å‚æ¨¡å¼)
- [6.è£…é¥°å™¨æ¨¡å¼](#6è£…é¥°å™¨æ¨¡å¼)
- [7.é€‚é…å™¨æ¨¡å¼](#7é€‚é…å™¨æ¨¡å¼)
- [8.ä»£ç†æ¨¡å¼](#8ä»£ç†æ¨¡å¼)
  - [8.1å¯¹è±¡ä»£ç†](#81å¯¹è±¡ä»£ç†)
  - [8.2äº‹ä»¶ä»£ç†](#82äº‹ä»¶ä»£ç†)
  - [8.3ç¼“å­˜ä»£ç†](#83ç¼“å­˜ä»£ç†)

## å‰è¨€

>ç”Ÿæ´»å……æ»¡ç€å¥—è·¯ï¼Œæˆ‘ä»¬å¿…é¡»ä¸æ–­å¥”è·‘æ‰èƒ½ä¿æŒåœç•™åœ¨åŸåœ°ã€‚

å†™ä»£ç ä¹Ÿä¸€æ ·æœ‰å¥—è·¯ï¼Œè€Œä¸”å¥—è·¯å¤šè¾¾äºŒåå¤šç§ï¼Œä½†åœ¨ JS è¯­è¨€ä¸­å¸¸ç”¨åˆ°çš„ä»…8ç§ï¼Œæœ‰äº›å¥—è·¯æˆ‘ä»¬å¯èƒ½æœ‰ç”¨è¿‡ä½†å¯¹ä¸ä¸Šåå­—ğŸ˜‚ï¼Œæ‰€ä»¥é˜…è¯»æ—¶å¯èƒ½ä¼šæœ‰â€œğŸ˜¯å“¦ï¼ŒåŸæ¥è¿™ä¸ªå°±æ˜¯xxå¥—è·¯å•Šâ€çš„æ„Ÿæ…¨ã€‚ä¸ºåŠ æ·±è¯»è€…å¯¹å¥—è·¯çš„ç†è§£å’Œè®°å¿†ï¼Œæ–‡ç« ç»“åˆäº†å¤§é‡ä¾‹å­å’Œç»å…¸çš„åº”ç”¨åœºæ™¯ã€‚

è¿™è¾¹å…ˆç‚¹ä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ªä»£ç åŸåˆ™å¾ˆé‡è¦

**ã€å¼€æ”¾å°é—­ã€‘åŸåˆ™**

ä»€ä¹ˆæ˜¯ã€å¼€æ”¾å°é—­ã€‘ï¼Ÿç®€å•æ¥è¯´å°±æ˜¯ï¼šå½“è¦æ”¹å˜æˆ–æ‰©å±•ç¨‹åºæ—¶ï¼Œå¯ä»¥å¢åŠ ä»£ç ï¼Œä½†ä¸è¦ä¿®æ”¹åŸæ¥çš„é€»è¾‘ã€‚

é˜…è¯»æ–‡ç« æ—¶å¯ä»¥å¤šç•™æ„ä¸‹ï¼Œå¾ˆå¤šè®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†è®©ä»£ç éµå¾ªã€å¼€æ”¾å°é—­ã€‘åŸåˆ™ã€‚å¦‚æœä½ å†™çš„ä»£ç éµå®ˆè¿™ä¸ªåŸåˆ™ï¼Œé‚£ bug æ•°é‡å°†ä¼šå¤§å¤§å‡å°‘å–”ï¼

ğŸ‘‡ğŸ»ä¸‹é¢å¼€å§‹å¥—è·¯æ—¶é—´..

## 1.è§‚å¯Ÿè€…æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼æ˜¯é¢è¯•çš„è¶…é«˜é¢‘è€ƒç‚¹ã€‚

è§‚å¯Ÿè€…æ¨¡å¼ï¼Œåˆç§°å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚å‘å¸ƒè€…ä¸»è¦æ‹¥æœ‰ï¼šæ·»åŠ è®¢é˜…ï¼Œå‘å¸ƒé€šçŸ¥åŠŸèƒ½ï¼Œè®¢é˜…è€…ä¸»è¦æœ‰ï¼šæ¥å—é€šçŸ¥ï¼Œæ‰§è¡Œå‘½ä»¤åŠŸèƒ½ã€‚

åº”ç”¨åœºæ™¯ï¼š

- Vue.js çš„åŒå‘ç»‘å®š
- Event Bus

**è§‚å¯Ÿæ¨¡å¼çš„ç®€å•å®ç°ï¼š**

```js
class Publisher {
  constructor() {
    this.observers = [];
  }

  addObserver(observer) {
    this.observers.push(observer);
  }

  publish() {
    this.observers.forEach((item) => {
      item.receive();
    });
  }
}
class Observer {
  receive() {
    console.log("æ”¶åˆ°é€šçŸ¥åæ‰§è¡Œå‘½ä»¤");
  }
}

const obs = new Observer();
const publish = new Publisher();

publish.addObserver(obs);
publish.publish(); // æ”¶åˆ°é€šçŸ¥åæ‰§è¡Œå‘½ä»¤
```

è¦è¿›ä¸€æ­¥äº†è§£è§‚å¯Ÿæ¨¡å¼å¯ä»¥å‰å¾€ï¼š

- [Vue åŒå‘ç»‘å®šå®ç°åŸç†](../Vue/Vueæºç è§£è¯».md#åŒå‘ç»‘å®šå®ç°)
- [æ‰‹å†™ EventBus](../æ‰‹å†™ä»£ç /æ‰‹å†™ä»£ç ç³»åˆ—.md#å®ç°EventBus)

## 2.å•ä¾‹æ¨¡å¼

å•ä¾‹æ¨¡å¼ä»…å…è®¸ç±»æˆ–å¯¹è±¡å…·æœ‰å•ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”å®ƒä½¿ç”¨å…¨å±€å˜é‡æ¥å­˜å‚¨è¯¥å®ä¾‹ã€‚

**å®ç°æ–¹æ³•**ï¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥å¯¹è±¡çš„å®ä¾‹ï¼Œå¦‚æœå·²å­˜åœ¨åˆ™ä¸å†åˆ›å»ºï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºå®ä¾‹å¹¶ä½¿ç”¨é—­åŒ…å°†å®ä¾‹å­˜èµ·æ¥

**ä½¿ç”¨åœºæ™¯**ï¼šé€‚ç”¨äºä¸šåŠ¡åœºæ™¯ä¸­åªèƒ½å­˜åœ¨ä¸€ä¸ªçš„å®ä¾‹ï¼Œæ¯”å¦‚å¼¹çª—ï¼Œè´­ç‰©è½¦

```javascript
// æ‡’æ±‰å¼

let ShopCar = (function () {
  let instance;
  function init() {
    /*è¿™é‡Œå®šä¹‰å•ä¾‹ä»£ç */
    return {
      buy(good) {
        this.goods.push(good);
      },
      goods: [],
    };
  }
  return {
    getInstance: function () {
      if (!instance) {
        instance = init();
      }
      return instance;
    },
  };
})();
let car1 = ShopCar.getInstance();
let car2 = ShopCar.getInstance();
car1.buy("æ©˜å­");
car2.buy("è‹¹æœ");
console.log(car1.goods); //[ 'æ©˜å­', 'è‹¹æœ' ]
console.log(car1 === car2); // true
```

```javascript
// é¥¿æ±‰å¼

var ShopCar = (function () {
  var instance = init();
  function init() {
    /*è¿™é‡Œå®šä¹‰å•ä¾‹ä»£ç */
    return {
      buy(good) {
        this.goods.push(good);
      },
      goods: [],
    };
  }
  return {
    getInstance: function () {
      return instance;
    },
  };
})();
let car1 = ShopCar.getInstance();
let car2 = ShopCar.getInstance();
car1.buy("æ©˜å­");
car2.buy("è‹¹æœ"); //[ 'æ©˜å­', 'è‹¹æœ' ]
console.log(car1.goods);
console.log(car1 === car2); // true
```

å®ç°æ•ˆæœæœ‰ä¸¤ç§ï¼Œæ‡’æ±‰å¼å’Œé¥¿æ±‰å¼ï¼Œå„æœ‰ä¼˜åŠ£ï¼ŒæŒ‰éœ€æ±‚ä½¿ç”¨

- æ‡’æ±‰å¼åœ¨ç±»åŠ è½½æ—¶ï¼Œä¸åˆ›å»ºå®ä¾‹ï¼Œå› æ­¤ç±»åŠ è½½é€Ÿåº¦å¿«ï¼Œä½†è¿è¡Œæ—¶è·å–å¯¹è±¡çš„é€Ÿåº¦æ…¢ï¼›
- é¥¿æ±‰å¼åœ¨ç±»åŠ è½½æ—¶å°±å®Œæˆäº†åˆå§‹åŒ–ï¼Œæ‰€ä»¥ç±»åŠ è½½è¾ƒæ…¢ï¼Œä½†è·å–å¯¹è±¡çš„é€Ÿåº¦å¿«

## 3.ç­–ç•¥æ¨¡å¼

ç­–ç•¥æ¨¡å¼è§£éš¾åº¦ä¸å¤§ï¼Œå¹¶ä¸”åœ¨é¢è¯•ä¸­æƒé‡ä¸é«˜ï¼Œæ‰€ä»¥èƒ½ç†è§£ä¼šä½¿ç”¨å³å¯ã€‚

ç­–ç•¥æ¨¡å¼ç®€å•æ¥è¯´å°±æ˜¯åˆ©ç”¨å¯¹è±¡æ˜ å°„ï¼Œé¿å…ç¼–å†™è¿‡å¤š `if else` ã€‚

æ¯”å¦‚æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š

```js
// è¯¢ä»·æ–¹æ³•ï¼Œæ¥å—ä»·æ ¼æ ‡ç­¾å’ŒåŸä»·ä¸ºå…¥å‚
function askPrice(tag, originPrice) {
  // å¤„ç†é¢„çƒ­ä»·
  if (tag === "pre") {
    if (originPrice >= 100) {
      return originPrice - 20;
    }
    return originPrice * 0.9;
  }

  // å¤„ç†å¤§ä¿ƒä»·
  if (tag === "onSale") {
    if (originPrice >= 100) {
      return originPrice - 30;
    }
    return originPrice * 0.8;
  }

  // å¤„ç†è¿”åœºä»·
  if (tag === "back") {
    if (originPrice >= 200) {
      return originPrice - 50;
    }
    return originPrice;
  }
}
```

ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ”¹é€ åï¼š

```js
// ä»·æ ¼å¤„ç†å¯¹è±¡
let priceProcessor = {
  prePrice(originPrice) {
    if (originPrice >= 100) {
      return originPrice - 20;
    }
    return originPrice * 0.9;
  },
  salePrice(originPrice) {
    if (originPrice >= 100) {
      return originPrice - 30;
    }
    return originPrice * 0.8;
  },
  backPrice(originPrice) {
    if (originPrice >= 200) {
      return originPrice - 50;
    }
    return originPrice;
  },
};

// è¯¢é—®ä»·æ ¼
function askPrice(tag, originPrice) {
  return priceProcessor[tag](originPrice);
}
```

ä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„ä¼˜åŠ¿ï¼š

- ä¸åŒé€»è¾‘ä¹‹é—´éš”ç¦»å¼€ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚æ¯”å¦‚å½“ä¿®æ”¹ `prePrice` é€»è¾‘åä»…éœ€è®©æµ‹è¯•åŒå­¦å›å½’è¯¥ç±»å‹ä»·æ ¼çš„åŠŸèƒ½å³å¯
- æ–¹ä¾¿å¢åŠ æ–°çš„ä»·æ ¼ï¼Œç›´æ¥ `priceProcessor.newPrice` å³å¯

> ç»¼ä¸Šå¯ä»¥æ€»ç»“å‡ºæ¥ç­–ç•¥æ¨¡å¼çš„å®šä¹‰ï¼šå®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•,æŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥, å¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢ã€‚

ç”¨ç¬”è€…è‡ªå·±çš„è¯æ¥é˜è¿°ï¼š

> å°† if else ä¸åŒé€»è¾‘éƒ½ç‹¬ç«‹åˆ°å‡½æ•°ä¸­ï¼Œå°†è¿™äº›å‡½æ•°æ˜ å°„åˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œæœ€åå¯¹å¤–æä¾›ä¸€ä¸ªæ¥å£å‡½æ•°ç”¨äºå¤–éƒ¨è°ƒç”¨ã€‚

## 4.çŠ¶æ€æ¨¡å¼

> çŠ¶æ€æ¨¡å¼(State Pattern) ï¼šå…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥ä¼¼ä¹ä¿®æ”¹äº†å®ƒçš„ç±»ã€‚

```js
class Fox {
  constructor() {
    this.animationType = "default";
    this.foxLevel = 1;
  }
  // åŠ¨ç”»å¤„ç†å™¨
  animationProcessor = {
    that: this,
    default() {
      console.log(`fox level ä¸º ${this.that.foxLevel} çš„é»˜è®¤åŠ¨ç”»`);
    },
    feed() {
      console.log(`fox level ä¸º ${this.that.foxLevel} çš„å–‚é£ŸåŠ¨ç”»`);
    },
    touch() {
      console.log(`fox level ä¸º ${this.that.foxLevel} çš„æŠšæ‘¸åŠ¨ç”»`);
    },
    upLevel() {
      console.log(`fox level ä¸º ${this.that.foxLevel} çš„å‡çº§åŠ¨ç”»`);
    },
    // å–‚é£Ÿã€å‡çº§ç»„åˆåŠ¨ç”»
    feedAndUpLevel() {
      console.log(`fox level ä¸º ${this.that.foxLevel} çš„å–‚é£Ÿå¹¶ä¸”å‡çº§åŠ¨ç”»`);
    },
  };

  // è§¦å‘åŠ¨ç”»
  triggerAnimation(animationType) {
    try {
      this.animationProcessor[animationType]();
    } catch (err) {
      console.error("æ‰§è¡ŒåŠ¨ç”»å‡ºé”™", err.message);
    }
    this.animationType = animationType;
  }
}

const myFox = new Fox();
myFox.triggerAnimation("feed"); // fox level ä¸º 1 çš„å–‚é£ŸåŠ¨ç”»
```

## 5.å·¥å‚æ¨¡å¼

**ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ**

å½“ç±»è¿‡å¤šä¸æ–¹ä¾¿ç®¡ç†ï¼Œä¸”éœ€è¦åˆ›å»ºçš„å¯¹è±¡ä¹‹é—´å­˜åœ¨æŸäº›å…³è”ï¼ˆæœ‰åŒä¸€ä¸ªçˆ¶ç±»ã€å®ç°åŒä¸€ä¸ªæ¥å£ç­‰ï¼‰æ—¶ï¼Œä¸å¦¨ä½¿ç”¨å·¥å‚æ¨¡å¼

**ä½œç”¨ï¼Ÿ**

å·¥å‚æ¨¡å¼æä¾›ä¸€ç§é›†ä¸­åŒ–ã€ç»Ÿä¸€åŒ–çš„æ–¹å¼ï¼Œé¿å…äº†åˆ†æ•£åˆ›å»ºå¯¹è±¡å¯¼è‡´çš„ä»£ç é‡å¤ã€çµæ´»æ€§å·®çš„é—®é¢˜ã€‚

### 5.1ç®€å•å·¥å‚æ¨¡å¼

ä¾‹å¦‚æˆ‘ä»¬ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ï¼šæ‰“é€ ä¸€ä¸ªå¯åˆ¶é€ å¤šå“ç‰Œæ±½è½¦çš„å·¥å‚

```js
// æ±½è½¦æ„é€ å‡½æ•°
function SuzukiCar(color) {
  this.color = color;
  this.brand = "Suzuki";
}

// æ±½è½¦æ„é€ å‡½æ•°
function HondaCar(color) {
  this.color = color;
  this.brand = "Honda";
}

// æ±½è½¦æ„é€ å‡½æ•°
function BMWCar(color) {
  this.color = color;
  this.brand = "BMW";
}

// æ±½è½¦å“ç‰Œæšä¸¾
const BRANDS = {
  suzuki: 1,
  honda: 2,
  bmw: 3,
};

/**
 * æ±½è½¦å·¥å‚
 */
function CarFactory() {
  this.create = function (brand, color) {
    switch (brand) {
      case BRANDS.suzuki:
        return new SuzukiCar(color);
      case BRANDS.honda:
        return new HondaCar(color);
      case BRANDS.bmw:
        return new BMWCar(color);
      default:
        break;
    }
  };
}
```

### 5.2æŠ½è±¡å·¥å‚æ¨¡å¼

ç†è§£æŠ½è±¡å·¥å‚ï¼Œè¦ç†æ¸…å››ä¸ªæ¦‚å¿µï¼š

- æŠ½è±¡å·¥å‚ï¼šæŠ½è±¡ç±»ï¼Œç”¨äºå£°æ˜äº§å“æœ€ç»ˆç›®æ ‡çš„å…±æ€§ã€‚
- å…·ä½“å·¥å‚ï¼šç»§æ‰¿è‡ªæŠ½è±¡å·¥å‚ï¼Œå®ç°äº†æŠ½è±¡å·¥å‚å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºæœ€ç»ˆçš„äº§å“ã€‚
- æŠ½è±¡äº§å“ï¼šæŠ½è±¡ç±»ï¼Œç”¨äºå£°æ˜ç»†ç²’åº¦äº§å“çš„å…±æ€§ã€‚
- å…·ä½“äº§å“ï¼šç»§æ‰¿è‡ªæŠ½è±¡äº§å“ï¼Œå®ç°äº†æŠ½è±¡äº§å“å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºç»†ç²’åº¦çš„äº§å“ã€‚å…·ä½“å·¥å‚ä¸­æ¥å£çš„å®ç°ä¾èµ–äºå…·ä½“äº§å“ç±»ã€‚

å’‹ä¸€çœ‹æ¦‚å¿µæ™•ä¹ä¹çš„ï¼Œæ¥çœ‹ä¸ªå…·ä½“åº”ç”¨å°±æ¸…æ™°äº†ï¼š

```js
// æŠ½è±¡å·¥å‚
class MobileFactory {
  constructor(name) {
    this.brandName = name;
  }

  installOS() {
    throw new Error("å½“å‰ä¸ºæŠ½è±¡å·¥å‚ï¼Œå­å“ç‰Œéœ€å®ç°è¯¥åŠŸèƒ½");
  }
}

// å…·ä½“å·¥å‚
class HuaWei extends MobileFactory {
  installOS(OS) {
    OS.install(this);
  }
}

// æŠ½è±¡äº§å“
class OS {
  constructor(name) {
    this.name = name;
  }
  install(phone) {
    throw new Error("å½“å‰ä¸ºæŠ½è±¡äº§å“ï¼Œéœ€è¢«ç»§æ‰¿å¹¶å®ç°");
  }
}

// å…·ä½“äº§å“
class IosOS extends OS {
  constructor() {
    super("IOS");
  }
  install(phone) {
    console.log(`${phone.brandName} install ${this.name} OS success`);
  }
}
class AndroidOS extends OS {
  constructor() {
    super("Android");
  }
  install(phone) {
    console.log(`${phone.brandName} install ${this.name} OS success`);
  }
}

// ç”Ÿäº§åä¸ºæ‰‹æœº p40
const huaweiP40 = new HuaWei("HuaWei P40");
const androidOSInstance = new AndroidOS();
huaweiP40.installOS(androidOSInstance); // HuaWei P40 install Android OS success
```

ä»ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œ`æŠ½è±¡å·¥å‚` å’Œ `æŠ½è±¡äº§å“` éƒ½æ˜¯ç”¨æ¥åˆ¶å®šè§„èŒƒçš„ï¼Œè€ŒçœŸæ­£å¹²æ´»çš„æ˜¯ `å…·ä½“å·¥å‚` å’Œ `å…·ä½“äº§å“` ã€‚å·¥å‚å’Œäº§å“å…¶å®æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯ç²’åº¦å¤§å°åˆ’åˆ†ä¸åŒã€‚

æŠ½è±¡å·¥å‚é€šè¿‡æŠ½è±¡å·¥å‚ç±»å’ŒæŠ½è±¡äº§å“ç±»åˆ¶å®šäº†è§„èŒƒï¼Œä½¿å¾—å¤æ‚ä¸šåŠ¡å˜å¾—æ¸…æ™°ï¼Œæœ€åå…·ä½“å·¥å‚å°†å…·ä½“äº§å“æ‹¼æ¥æ•´åˆä»è€Œå®ç°ä¸€ä¸ªå®Œæ•´çš„äº§å“ã€‚

## 6.è£…é¥°å™¨æ¨¡å¼

è£…é¥°å™¨æ¨¡å¼çš„åŸåˆ™ï¼šåœ¨ä¸æ”¹åŠ¨åŸæ¥ä»£ç é€»è¾‘çš„åŸºç¡€ä¸Šå»æ·»åŠ å¢é‡ä»£ç ã€‚

å‡è®¾å·²æœ‰æ—§ä»£ç ï¼š

```js
window.onload = () => {
  console.log(document.getElementByTagName("*").length); // 8
};
```

ç°æœ‰éœ€æ±‚ï¼Œéœ€åœ¨é¡µé¢åŠ è½½å®Œæˆåæ‰“å° 'é¡µé¢åŠ è½½å®Œæ¯•' ã€‚

ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ¥å®ç°ï¼š

```js
const fn = window.onload;
window.onload = () => {
  typeof fn === "function" && fn();
  console.log("é¡µé¢åŠ è½½å®Œæ¯•");
};
// 8
// é¡µé¢åŠ è½½å®Œæ¯•
```

ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼Œä¸ä¼šè§¦ç¢°åˆ°æ—§ä»£ç ï¼Œå¤§å¤§é™ä½äº† bug å‡ºç°çš„å‡ ç‡ã€‚

## 7.é€‚é…å™¨æ¨¡å¼

é€‚é…å™¨æ¨¡å¼ä¸»è¦ç”¨æ¥å…¼å®¹ä»£ç ã€‚

å‡è®¾æœ‰ä¸€ä¸ªè¿œå¤é¡¹ç›®ï¼Œæ•°æ®è¯·æ±‚ä½¿ç”¨çš„æ˜¯ ajax åº“ã€‚

```js
// å‘é€getè¯·æ±‚
Ajax('get', urlåœ°å€, postå…¥å‚, function(data){
    // æˆåŠŸçš„å›è°ƒé€»è¾‘
}, function(error){
    // å¤±è´¥çš„å›è°ƒé€»è¾‘
})
```

ç°åœ¨éœ€æ±‚è¦å°†æ•°æ®è¯·æ±‚åº“æ”¹ä¸ºç°ä»£è¯·æ±‚åº“ fetch ã€‚

å¦‚æœæˆ‘ä»¬åœ¨è°ƒç”¨äº† Ajax çš„åœ°æ–¹éƒ½å»ä¿®æ”¹ï¼Œé‚£ä¿®æ”¹ã€æµ‹è¯•æˆæœ¬å¤ªé«˜ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨åˆ°é€‚é…å™¨æ¨¡å¼ã€‚

```js
// Ajaxé€‚é…å™¨å‡½æ•°ï¼Œå…¥å‚ä¸æ—§æ¥å£ä¿æŒä¸€è‡´
async function AjaxAdapter(type, url, data, success, failed) {
    const type = type.toUpperCase()
    let result
    try {
         // å®é™…çš„è¯·æ±‚å…¨éƒ¨ç”±æ–°æ¥å£å‘èµ·
         if(type === 'GET') {
            result = await HttpUtils.get(url) || {}
        } else if(type === 'POST') {
            result = await HttpUtils.post(url, data) || {}
        }
        // å‡è®¾è¯·æ±‚æˆåŠŸå¯¹åº”çš„çŠ¶æ€ç æ˜¯1
        result.statusCode === 1 && success ? success(result) : failed(result.statusCode)
    } catch(error) {
        // æ•æ‰ç½‘ç»œé”™è¯¯
        if(failed){
            failed(error.statusCode);
        }
    }
}

// ç”¨é€‚é…å™¨é€‚é…æ—§çš„Ajaxæ–¹æ³•
async function Ajax(type, url, data, success, failed) {
    await AjaxAdapter(type, url, data, success, failed)
}
```

ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼š
1. è¦å®ç°ä¸€ä¸ªé€‚é…å™¨è®©åŸå…ˆè°ƒç”¨ Ajax å‡½æ•°çš„å‚æ•°èƒ½æ— ç¼è¡”æ¥åˆ°æ–°çš„è¯·æ±‚åº“ä¸Š
2. è¦†ç›– Ajax å‡½æ•°ï¼Œè°ƒç”¨é€‚é…å™¨

è¿™æ ·ä¸€æ¥ï¼ŒåŸæœ¬è°ƒç”¨ Ajax å‡½æ•°åœ°æ–¹å°±å¯ä»¥ä¸å¿…éœ€æ”¹ç›´æ¥å¤ç”¨ã€‚

## 8.ä»£ç†æ¨¡å¼

### 8.1å¯¹è±¡ä»£ç†

é™åˆ¶ä¸€ä¸ªå¯¹è±¡ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œéœ€è¦ç¬¬ä¸‰è€…ï¼ˆä»£ç†ï¼‰ç‰µæ¡¥æ­çº¿æ‰èƒ½è®¿é—®ï¼Œè¿™å°±æ˜¯ä»£ç†æ¨¡å¼ã€‚

é€šå¸¸ä½¿ç”¨ ES6 çš„ Proxy æ¥å®ç°ä»£ç†ã€‚

æ¥çœ‹ä¸€ä¸ªç¤¾äº¤ App çš„ä¸šåŠ¡

1. ç”¨æˆ·æœªç™»å½•ï¼Œä»…çœ‹æŸ¥çœ‹é™Œç”Ÿäººçš„å¤´åƒã€æ˜µç§°ç­‰åŸºæœ¬ä¿¡æ¯
2. ç”¨æˆ·ä¸ºæ™®é€šç”¨æˆ·ï¼Œå¯æŸ¥çœ‹é™Œç”Ÿäººçš„åŸºæœ¬ä¿¡æ¯å¤–ï¼Œè¿˜å¯æŸ¥çœ‹å­¦å†
3. ç”¨æˆ·ä¸ºVipç”¨æˆ·ï¼Œé™¤äº†ä»¥ä¸Šä¿¡æ¯è¿˜å¯æŸ¥çœ‹é™Œç”Ÿäººçš„ç”Ÿæ´»ç…§ç‰‡

```js
// è¦ä»£ç†çš„é™Œç”Ÿäºº
const stranger = {
  nickname: 'jack ma',
  portrait: 'å¤´åƒ',
  educationBackground: 'æœ¬ç§‘',
  lifePhotos: []
}

// æƒé™ç»„
const baseInfo = ['nickname', 'portrait']
const loginInfo = ['educationBackground']
const vipInfo = ['lifePhotos']

// ç™»å½•ç”¨æˆ·
const user = {
  isLogin: true,
  isVIP: false,
}

// å®ç°ä»£ç†
const objProxy = new Proxy(stranger, {
  get(obj, key) {
    if(!user.isLogin && loginInfo.indexOf(key) !== -1) {
      console.log('è¯·å…ˆç™»å…¥')
      return
    }else if(!user.isVIP && vipInfo.indexOf(key) !== -1){
      console.log('è¯·å…ˆæˆä¸ºVIP')
      return
    }
    return obj[key]
  },
  set(obj, key, val) {
    return val
  }
})

console.log(objProxy.nickname) // jack ma
console.log(objProxy.educationBackground) // æœ¬ç§‘
console.log(objProxy.lifePhotos) // undefined
```

### 8.2äº‹ä»¶ä»£ç†

å½“è¦ç»™å¤šä¸ªå­å…ƒç´ æ·»åŠ ç‚¹å‡»äº‹ä»¶æ—¶ï¼Œå¼€é”€æ¯”è¾ƒå¤§

```html
  <div id="father">
    <a href="#">é“¾æ¥1å·</a>
    <a href="#">é“¾æ¥2å·</a>
    <a href="#">é“¾æ¥3å·</a>
    <a href="#">é“¾æ¥4å·</a>
    <a href="#">é“¾æ¥5å·</a>
    <a href="#">é“¾æ¥6å·</a>
  </div>
```

æˆ‘ä»¬å¯ä»¥å°†äº‹ä»¶ä»£ç†åˆ°çˆ¶å…ƒç´ ä¸Š

```js
// è·å–çˆ¶å…ƒç´ 
const father = document.getElementById('father')

// ç»™çˆ¶å…ƒç´ å®‰è£…ä¸€æ¬¡ç›‘å¬å‡½æ•°
father.addEventListener('click', function(e) {
    // è¯†åˆ«æ˜¯å¦æ˜¯ç›®æ ‡å­å…ƒç´ 
    if(e.target.tagName === 'A') {
        // ä»¥ä¸‹æ˜¯ç›‘å¬å‡½æ•°çš„å‡½æ•°ä½“
        e.preventDefault()
        alert(`æˆ‘æ˜¯${e.target.innerText}`)
    }
} )
```

å½“ç‚¹å‡»å­å…ƒç´ æ—¶ï¼Œé€šè¿‡äº‹ä»¶å†’æ³¡è§¦å‘äº†çˆ¶å…ƒç´ çš„ç‚¹å‡»æ–¹æ³•ï¼Œå¹¶é€šè¿‡ `e.target` è·å–åˆ°çœŸå®è¢«ç‚¹å‡»çš„å­å…ƒç´ ï¼Œè¿™ä¹Ÿå±äºä¸€ç§ä»£ç†æ¨¡å¼ã€‚

### 8.3ç¼“å­˜ä»£ç†
å½“æœ‰è¾ƒå¤æ‚çš„è¿ç®—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼“å­˜ä»£ç†å°†å·²ç»è®¡ç®—è¿‡çš„å€¼ç¼“å­˜èµ·æ¥ï¼Œé¿å…äºŒæ¬¡è¿ç®—ä»è€Œé™ä½å¼€é”€ã€‚

æ¯”å¦‚æˆ‘ä»¬å·²å®ç°ä¸€ä¸ªè®¡ç®—æ‰€æœ‰å…¥å‚ä¹‹å’Œçš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»£ç†å°†è®¡ç®—è¿‡çš„å€¼ç¼“å­˜èµ·æ¥ï¼š

```js
// å¯¹ä¼ å…¥çš„æ‰€æœ‰å‚æ•°åšæ±‚å’Œ
const addAll = function() {
    let result = 0
    const len = arguments.length
    for(let i = 0; i < len; i++) {
        result += arguments[i]
    }
    return result
}

// ä¸ºæ±‚å’Œæ–¹æ³•åˆ›å»ºä»£ç†
const proxyAddAll = (function(){
    // æ±‚å’Œç»“æœçš„ç¼“å­˜æ± 
    const resultCache = {}
    return function() {
        // å°†å…¥å‚è½¬åŒ–ä¸ºä¸€ä¸ªå”¯ä¸€çš„å…¥å‚å­—ç¬¦ä¸²
        const args = Array.prototype.join.call(arguments, ',')
        
        // æ£€æŸ¥æœ¬æ¬¡å…¥å‚æ˜¯å¦æœ‰å¯¹åº”çš„è®¡ç®—ç»“æœ
        if(args in resultCache) {
            // å¦‚æœæœ‰ï¼Œåˆ™è¿”å›ç¼“å­˜æ± é‡Œç°æˆçš„ç»“æœ
            return resultCache[args]
        }
        return resultCache[args] = addAll(...arguments)
    }
})()
```

ä»¥ä¸Šä¾‹å­ä¸­ï¼ŒresultCache å¯¹è±¡ä¸ºç¼“å­˜æ± ï¼Œå¯¹è±¡ key ä¸ºæ‰€æœ‰å…¥å‚ arguments è½¬åŒ–çš„å­—ç¬¦ä¸²ï¼Œå¯¹è±¡ value ä¸ºåˆè®¡ç»“æœã€‚è¿™æ ·ä¸€æ¥ï¼Œé€šè¿‡ proxyAddAll å°±å¯ä»¥å®ç°ç¼“å­˜ä»£ç†ã€‚