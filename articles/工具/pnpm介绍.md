
## npm 和 yarn 存在的问题

npm v2版本之前采用包嵌套形式，导致了以下问题：

1. 不同包底下会出现相同的依赖，占用了额外的硬盘空间
2. 依赖层层嵌套，会出现引用路径过长问题（windows 的文件路径最长是 260 多个字符）

npm v3 和 yarn 针对以上问题的解决方式：

> 依赖不做嵌套，而是提升到外层平铺开来。

引发新的问题：

1. 幽灵依赖：没有声明在 dependencies 里的依赖，仍然可以 import。（因为依赖已平铺到外层）
2. 由于提升依赖只能提升一个版本，其他版本依然是以嵌套的形式存在，还是会存在浪费硬盘空间的情况

## pnpm 怎么解决这些问题

先了解两个概念：

1. 软连接：新建一个文件，文件内容指向另一个路径；
2. 硬连接：直接引用文件的地址；

pnpm实现原理：将包及包的相关依赖平铺地安装到一个全局仓库（node_modules/.pnpm），项目中 `package.json` 下的依赖通过硬连接引用，包与包之间的依赖则是通过软连接引用。

![pnpm官方原理图](/articles/工具/images/pnpm官方原理图.jpg)

优势

1. 省磁盘空间：每个包只会在全局仓库安装一次（以版本区分）；
2. 速度快：用连接形式来引用，节省了复制文件的时间；
3. 不存在幽灵依赖：由于平铺依赖是在全局仓库做，所以项目下的node_modules只会存在有引用的依赖。

