<!--
 * @Date: 2021-09-11 21:49:42
 * @LastEditors: wenfujie
 * @LastEditTime: 2022-01-12 14:30:04
 * @FilePath: /document-library/articles/手写代码/手写代码系列.md
-->

## 实现 JS 原生函数

### trim

```js
String.prototype.trim = function() {
  return this.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
}
```



## 实现EventBus

运用了发布订阅设计模式

```js
class Bus {
  constructor() {
    // {eventName: [cb1,cb2]}
    this.evnets = {};
  }
  $emit(eventName, ...params) {
    let callbacks = this.evnets[eventName];
    if (!callbacks) return;

    // 避免通过 once 安装的监听器在移除的过程中出现顺序问题，此处需要浅拷贝
    callbacks = callbacks.slice();
    callbacks.forEach((item) => item(...params));
  }
  $on(eventName, cb) {
    if (!this.evnets[eventName]) {
      this.evnets[eventName] = [];
    }
    this.evnets[eventName].push(cb);
  }
  $off(eventName, cb) {
    const callbacks = this.evnets[eventName];
    if (callbacks && callbacks.length) {
      const index = callbacks.findIndex((item) => item === cb);
      index !== -1 && callbacks.splice(index, 1);
    }
  }
  $once(eventName, cb) {
    this.$on(eventName, (...params) => {
      this.$off(eventName);
      cb(...params);
    });
  }
}
```

## 手写简版Generator函数

ES6的Generator函数可生成一个可迭代对象，该对象可供 for of 迭代。

**Generator函数的简单使用**
```js
function *test(){
  yield 'test1'
  yield 'test2'
}

const testInstance = test()
console.log(testInstance.next())
console.log(testInstance.next())
console.log(testInstance.next())

// { value: 'test1', done: false }
// { value: 'test2', done: false }
// { value: undefined, done: true }
```

**使用for of遍历**
```js
for (const item of testInstance) {
  console.log(item);
}
// test1
// test2
```

**试着实现一个Generator函数**

分析：
1. 函数需返回一个对象，包含next方法
2. 调用next方法，返回对象{value, done}

```js
function makeIterator(data) {
  let index = 0;
  return {
    next() {
      return index >= data.length
        ? { value: data[index++], done: true }
        : { value: data[index++], done: false };
    },
  };
}

const iterator = makeIterator([1, 2]);

console.log(iterator.next()); // { value: 1, done: false }
console.log(iterator.next()); // { value: 2, done: false }
console.log(iterator.next()); // { value: undefined, done: true }
```