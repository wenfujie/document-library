<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>初始化组件实例过程 | wfj blog</title>
    <meta name="description" content="wfj的笔记">
    <meta name="generator" content="VitePress v1.1.3">
    <link rel="preload stylesheet" href="/document-library/assets/style.CpmFdX5n.css" as="style">
    
    <script type="module" src="/document-library/assets/app.Bk3Z3Eui.js"></script>
    <link rel="preload" href="/document-library/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/document-library/assets/chunks/theme.BN_M_p0k.js">
    <link rel="modulepreload" href="/document-library/assets/chunks/framework.BC8w3fXH.js">
    <link rel="modulepreload" href="/document-library/assets/前端框架_vue3_vue3设计和原理_renderer_初始化组件实例过程.md.BKw10QM1.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-ddfa2f33><!--[--><!--]--><!--[--><span tabindex="-1" data-v-f0953876></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-f0953876> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ddfa2f33 data-v-028b3868><div class="VPNavBar top" data-v-028b3868 data-v-95cdc288><div class="wrapper" data-v-95cdc288><div class="container" data-v-95cdc288><div class="title" data-v-95cdc288><div class="VPNavBarTitle" data-v-95cdc288 data-v-dd47ac4f><a class="title" href="/document-library/" data-v-dd47ac4f><!--[--><!--]--><!----><span data-v-dd47ac4f>wfj blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-95cdc288><div class="content-body" data-v-95cdc288><!--[--><!--]--><div class="VPNavBarSearch search" data-v-95cdc288><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-95cdc288 data-v-47f04c43><span id="main-nav-aria-label" class="visually-hidden" data-v-47f04c43>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/document-library/" tabindex="0" data-v-47f04c43 data-v-2cfb4f09><!--[--><span data-v-2cfb4f09>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/document-library/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80/html/H5%E5%BC%80%E5%8F%91FAQ.html" tabindex="0" data-v-47f04c43 data-v-2cfb4f09><!--[--><span data-v-2cfb4f09>前端基础</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/document-library/%E9%9D%A2%E8%AF%95/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E8%B5%84%E6%BA%90%E6%B1%87%E6%80%BB.html" tabindex="0" data-v-47f04c43 data-v-2cfb4f09><!--[--><span data-v-2cfb4f09>面试</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-95cdc288 data-v-b331b8a6><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-b331b8a6 data-v-76e93b6c data-v-de3d454b><span class="check" data-v-de3d454b><span class="icon" data-v-de3d454b><!--[--><span class="vpi-sun sun" data-v-76e93b6c></span><span class="vpi-moon moon" data-v-76e93b6c></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-95cdc288 data-v-323a4a2f data-v-635b2abf><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-635b2abf data-v-0d7e09d1><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-95cdc288 data-v-8a7d81fd data-v-1107b740><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-1107b740><span class="vpi-more-horizontal icon" data-v-1107b740></span></button><div class="menu" data-v-1107b740><div class="VPMenu" data-v-1107b740 data-v-bc07eef0><!----><!--[--><!--[--><!----><div class="group" data-v-8a7d81fd><div class="item appearance" data-v-8a7d81fd><p class="label" data-v-8a7d81fd>Appearance</p><div class="appearance-action" data-v-8a7d81fd><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-8a7d81fd data-v-76e93b6c data-v-de3d454b><span class="check" data-v-de3d454b><span class="icon" data-v-de3d454b><!--[--><span class="vpi-sun sun" data-v-76e93b6c></span><span class="vpi-moon moon" data-v-76e93b6c></span><!--]--></span></span></button></div></div></div><div class="group" data-v-8a7d81fd><div class="item social-links" data-v-8a7d81fd><div class="VPSocialLinks social-links-list" data-v-8a7d81fd data-v-635b2abf><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-635b2abf data-v-0d7e09d1><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-95cdc288 data-v-3349e59e><span class="container" data-v-3349e59e><span class="top" data-v-3349e59e></span><span class="middle" data-v-3349e59e></span><span class="bottom" data-v-3349e59e></span></span></button></div></div></div></div><div class="divider" data-v-95cdc288><div class="divider-line" data-v-95cdc288></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-ddfa2f33 data-v-ceff533d><div class="container" data-v-ceff533d><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-ceff533d data-v-a21258f0><button data-v-a21258f0>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-ddfa2f33 data-v-ccc6ec8e><div class="VPDoc has-aside" data-v-ccc6ec8e data-v-1d9b2cc0><!--[--><!--]--><div class="container" data-v-1d9b2cc0><div class="aside" data-v-1d9b2cc0><div class="aside-curtain" data-v-1d9b2cc0></div><div class="aside-container" data-v-1d9b2cc0><div class="aside-content" data-v-1d9b2cc0><div class="VPDocAside" data-v-1d9b2cc0 data-v-38653e19><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-38653e19 data-v-c03c2d51><div class="content" data-v-c03c2d51><div class="outline-marker" data-v-c03c2d51></div><div class="outline-title" role="heading" aria-level="2" data-v-c03c2d51>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-c03c2d51><span class="visually-hidden" id="doc-outline-aria-label" data-v-c03c2d51> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-c03c2d51 data-v-1e4e6cde><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-38653e19></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-1d9b2cc0><div class="content-container" data-v-1d9b2cc0><!--[--><!--]--><main class="main" data-v-1d9b2cc0><div style="position:relative;" class="vp-doc _document-library_%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6_vue3_vue3%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%8E%9F%E7%90%86_renderer_%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BB%84%E4%BB%B6%E5%AE%9E%E4%BE%8B%E8%BF%87%E7%A8%8B" data-v-1d9b2cc0><div><ul><li><a href="#初始化组件实例过程">初始化组件实例过程</a><ul><li><a href="#创建组件实例">创建组件实例</a></li><li><a href="#对组件实例优化处理赋值">对组件实例优化、处理、赋值</a><ul><li><a href="#创建上下文代理-instanceproxy">创建上下文代理 instance.proxy</a></li><li><a href="#执行-setup-函数">执行 setup 函数</a></li></ul></li></ul></li></ul><h1 id="初始化组件实例过程" tabindex="-1">初始化组件实例过程 <a class="header-anchor" href="#初始化组件实例过程" aria-label="Permalink to &quot;初始化组件实例过程&quot;">​</a></h1><blockquote><p>组件初始化时会执行 <code>mountComponent</code> 方法，内部会调用 <code>createComponentInstance</code> 方法创建一个组件实例化对象，并通过 <code>setupComponent</code> 方法对组件实例化对象进行优化、处理、赋值等操作。</p></blockquote><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mountComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">initialVNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">container</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">parentComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. 先创建一个 component instance</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> instance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (initialVNode.component </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createComponentInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    initialVNode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    parentComponent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. 初始化组件实例</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setupComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. 设置并运行带副作用的渲染函数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setupRenderEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance, initialVNode, container);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="创建组件实例" tabindex="-1">创建组件实例 <a class="header-anchor" href="#创建组件实例" aria-label="Permalink to &quot;创建组件实例&quot;">​</a></h2><p><code>createComponentInstance</code> 方法</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// packages/runtime-core/src/component.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> instance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 这里是组件对象</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  type: vnode.type, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 组件 vnode</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vnode,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 新的组件 vnode</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  next: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // props 相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  props: {}, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 指向父组件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  parent,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 依赖注入相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  provides: parent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parent.provides </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {},</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 渲染上下文代理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  proxy: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 标记是否被挂载</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  isMounted: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // attrs 相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  attrs: {}, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // slots 相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  slots: {}, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // context 相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ctx: {},</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // setup return 的状态数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  setupState: {}, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><blockquote><p>开发者频繁使用到组件实例下的 <code>ctx, setupState, data, props</code> 属性。</p></blockquote><h2 id="对组件实例优化、处理、赋值" tabindex="-1">对组件实例优化、处理、赋值 <a class="header-anchor" href="#对组件实例优化、处理、赋值" aria-label="Permalink to &quot;对组件实例优化、处理、赋值&quot;">​</a></h2><p><code>setupComponent</code> 方法</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setupComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isSSR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">props</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">children</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance.vnode;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 判断组件是否是有状态的组件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isStateful</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isStatefulComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 初始化 props</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  initProps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance, props, isStateful, isSSR);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 初始化 slots</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  initSlots</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance, children);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 如果是有状态组件，那么去设置有状态组件实例</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setupResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isStateful</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ?</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setupStatefulComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance, isSSR)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setupResult;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><ol><li>通过 <code>isStatefulComponent(instance)</code> 判断是否是有状态的组件；</li><li><code>initProps</code> 初始化 <code>props</code>；</li><li><code>initSlots</code> 初始化 <code>slots</code>；</li><li>根据组件是否是有状态的，来决定是否需要执行 <code>setupStatefulComponent</code> 函数。</li></ol></blockquote><p><code>isStatefulComponent</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isStatefulComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance.vnode.shapeFlag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ShapeFlags.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATEFUL_COMPONENT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>像 <code>函数式组件</code> 就是无状态组件。</p></blockquote><h3 id="创建上下文代理-instance-proxy" tabindex="-1">创建上下文代理 instance.proxy <a class="header-anchor" href="#创建上下文代理-instance-proxy" aria-label="Permalink to &quot;创建上下文代理 instance.proxy&quot;">​</a></h3><p><code>setupStatefulComponent</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setupStatefulComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isSSR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 定义 Component 变量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Component</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance.type</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. 创建渲染代理的属性访问缓存</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  instance.accessCache </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. 创建渲染上下文代理, 对 instance.ctx 对象进行代理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  instance.proxy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.ctx, PublicInstanceProxyHandlers);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. 执行 setup 函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (setup) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 如果 setup 函数带参数，则创建一个 setupContext</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setupContext</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (instance.setupContext </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      setup.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSetupContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 执行 setup 函数，获取结果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setupResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> callWithErrorHandling</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setup, instance, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [instance.props, setupContext])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 处理 setup 执行结果</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    handleSetupResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance, setupResult)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. 完成组件实例设置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    finishComponentSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance, isSSR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><ol><li>创建渲染代理的属性访问缓存</li><li>创建渲染上下文代理, 对 instance.ctx 对象进行代理</li><li>执行 setup 函数</li><li>完成组件实例设置</li></ol></blockquote><p><code>PublicInstanceProxyHandlers</code> 代理配置 <code>get</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PublicInstanceProxyHandlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setupState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">props</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">accessCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">appContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> normalizedProps</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (key[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;$&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 从缓存中获取当前 key 存在于哪个属性中</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accessCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[key]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (n) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessTypes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SETUP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setupState[key]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessTypes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[key]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessTypes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTEXT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx[key]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessTypes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PROPS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> props</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (setupState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EMPTY_OBJ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupState, key)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 从 setupState 中取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        accessCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessTypes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SETUP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setupState[key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EMPTY_OBJ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, key)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 从 data 中取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        accessCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessTypes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATA</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        (normalizedProps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance.propsOptions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(normalizedProps, key)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 从 props 中取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        accessCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessTypes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PROPS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> props</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EMPTY_OBJ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, key)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 从 ctx 中取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        accessCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessTypes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CONTEXT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx[key]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__FEATURE_OPTIONS_API__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shouldCacheAccess) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 都取不到</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        accessCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessTypes.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OTHER</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> publicGetter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> publicPropertiesMap[key]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cssModule, globalProperties</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (publicGetter) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 以 $ 保留字开头的相关函数和方法</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // css module</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (cssModule </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> type.__cssModules) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cssModule </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cssModule[key])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EMPTY_OBJ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, key)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 全局属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ((globalProperties </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> appContext.config.globalProperties),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(globalProperties, key))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (__DEV__) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 一些告警</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p><code>key[0] !== &#39;$&#39;</code> 判断是否为内置属性（<code>$</code> 开头的一般是 <code>Vue</code> 组件实例上的内置属性）。</p><p>取值优先级：setupState &gt; data &gt; props &gt; ctx</p></blockquote><blockquote><p><code>1. 创建渲染代理的属性访问缓存</code> 的目的：<code>accessCache</code> 存储了 <code>key</code> 与 <code>存储该key的对象</code> 的映射关系，便于后续访问 <code>key</code> 时快速获取，而不是每次从 <code>setupState</code> 、<code>data</code> 、<code>props</code> <code>ctx</code> 依次查询，属于空间换时间的优化。</p></blockquote><blockquote><p><code>2. 创建渲染上下文代理, 对 instance.ctx 对象进行代理</code> 的目的：在选项式中使用 <code>this.xxx</code> 取值时自动从 <code>setupState</code> 、<code>data</code> 、<code>props</code> <code>ctx</code> 依次查询，而不是要求用户使用 <code>this.$data.xxx</code> 和 <code>this.$props.xxx</code> 取值，降低用户使用负担。</p></blockquote><p><code>PublicInstanceProxyHandlers</code> 代理配置 <code>set</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PublicInstanceProxyHandlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setupState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (setupState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EMPTY_OBJ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupState, key)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 设置 setupState</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      setupState[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EMPTY_OBJ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, key)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 设置 data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      data[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.props, key)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 不能给 props 赋值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (key[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;$&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 不能给组件实例上的内置属性赋值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 用户自定义数据赋值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ctx[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>设置值的优先级和 <code>get</code>保持一致： <code>setupState</code> &gt; <code>data</code> &gt; <code>props</code></p></blockquote><p><code>PublicInstanceProxyHandlers</code> 代理配置 <code>has</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PublicInstanceProxyHandlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">setupState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">accessCache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">appContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">propsOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }}, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> normalizedProps</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      !!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">accessCache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EMPTY_OBJ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data, key)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (setupState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EMPTY_OBJ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupState, key)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ((normalizedProps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> propsOptions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(normalizedProps, key)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx, key) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(publicPropertiesMap, key) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      hasOwn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appContext.config.globalProperties, key)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>判断 <code>key</code> 是否存在于 <code>accessCache</code> &gt; <code>data</code> &gt; <code>setupState</code> &gt; <code>prop</code> &gt; <code>ctx</code> &gt; <code>publicPropertiesMap</code> &gt; <code>globalProperties</code>，然后返回结果。</p></blockquote><h3 id="执行-setup-函数" tabindex="-1">执行 setup 函数 <a class="header-anchor" href="#执行-setup-函数" aria-label="Permalink to &quot;执行 setup 函数&quot;">​</a></h3><blockquote><p><code>3.执行 setup 函数</code> 先用 <code>setup.length &gt; 1</code> 来判断是否调用 <code>createSetupContext</code> 创建上下文，然后通过 <code>callWithErrorHandling</code> 执行 <code>setup</code> ，最后调用 <code>handleSetupResult</code> 处理执行的结果。</p></blockquote><p><code>createSetupContext</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createSetupContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    get</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> attrs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> attrs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (attrs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createAttrsProxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    slots: instance.slots,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    emit: instance.emit,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    expose</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>callWithErrorHandling</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> callWithErrorHandling</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    handleError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err, instance, type)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p><code>callWithErrorHandling</code> 主要用于给目标函数增加异常捕获逻辑。</p></blockquote><p>所以本质上 <code>第3步</code> 逻辑为</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setupResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shallowReadonly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.props), setupContext);</span></span></code></pre></div><p><code>handleSetupResult</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleSetupResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">setupResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupResult)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // setup 返回渲染函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    instance.render </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setupResult</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupResult)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // proxyRefs 的作用就是把 setupResult 对象做一层代理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    instance.setupState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> proxyRefs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(setupResult);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  finishComponentSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>返回结果为函数就存储到组件实例的 <code>render</code> 上，若是对象存储到组件实例的 <code>setupState</code> 。</p></blockquote><p><code>finishComponentSetup</code></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> finishComponentSetup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // type 是个组件对象</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Component</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> instance.type;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">instance.render) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 如果组件没有 render 函数，那么就需要把 template 编译成 render 函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (compile </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Component.render) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Component.template) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 这里就是 runtime 模块和 compile 模块结合点</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 运行时编译</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Component.render </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Component.template, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        isCustomElement: instance.appContext.config.isCustomElement </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NO</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    instance.render </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Component.render;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (__FEATURE_OPTIONS_API__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__COMPAT__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> skipOptions)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 兼容选项式组件的调用逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>通常使用 <code>vue</code> 开发都会结合 <code>webpack</code> 或 <code>vite</code> 来辅助构建打包，这种形式下 <code>instance.render</code> 总会存在，但如果是直接在 <code>html</code> 通过 <code>script</code> 直接引用 <code>vue</code> 包，那 <code>instance.render</code> 则为空，此时就需 <code>runtimeWithCompiler</code> 的介入处理运行时编译，该方法就是用来处理这种特殊情况。</p></blockquote><p>至此，组件实例初始化流程结束。</p></div></div></main><footer class="VPDocFooter" data-v-1d9b2cc0 data-v-2d2e9160><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"DGAYUp1f\",\"index.md\":\"BSYk3gOp\",\"markdown-examples.md\":\"CLdPQzD8\",\"前端业务_h5拖拽_拖拽.md\":\"DYR6l_oD\",\"前端业务_压缩文件并下载.md\":\"DAKatfif\",\"前端业务_各种业务解决方案.md\":\"DueEE0PG\",\"前端业务_权限控制.md\":\"B12hRgLb\",\"前端业务_系统选择文件弹窗_index.md\":\"BQLCghov\",\"前端基础_css_有趣的css.md\":\"CTp0wNh8\",\"前端基础_css_盒模型及bfc.md\":\"B6Wdkt3a\",\"前端基础_css_自适应和响应式布局.md\":\"DYMdffWZ\",\"前端基础_css_面试题.md\":\"_mmubho7\",\"前端基础_html_h5开发faq.md\":\"CPNCvb4C\",\"前端基础_js_es6_esm_esm和commonjs.md\":\"D3CINX9M\",\"前端基础_js_es6_promise_介绍和实现.md\":\"Bzl6unHE\",\"前端基础_js_es6_新特性.md\":\"DWPQq1wF\",\"前端基础_js_基础_this指向.md\":\"Muv_79qU\",\"前端基础_js_es6_类.md\":\"BNwGZhA6\",\"前端基础_js_基础_事件循环.md\":\"BXYMT2dn\",\"前端基础_js_基础_原型链.md\":\"QvDHbmCf\",\"前端基础_js_基础_数据类型_数据类型的转换.md\":\"DViFH4Xq\",\"前端基础_js_基础_数据类型_数据类型的判断.md\":\"D24UFgLi\",\"前端基础_js_基础_遍历.md\":\"CTRIcGsy\",\"前端基础_js_基础_闭包.md\":\"HTwfoRI_\",\"前端基础_js_封装_数组扁平化.md\":\"CRMY2o6I\",\"前端基础_js_封装_深拷贝.md\":\"CAptF7uf\",\"前端基础_js_封装_防抖与节流_index.md\":\"C1fhKFM_\",\"前端基础_代码规范_变量命名.md\":\"F3KWxrdR\",\"前端基础_浏览器_bom.md\":\"D7r5n1ly\",\"前端基础_浏览器_dom事件总结.md\":\"DpGgRP9M\",\"前端基础_浏览器_v8引擎的垃圾回收.md\":\"Da2CIJFl\",\"前端基础_浏览器_谷歌浏览器开发者工具.md\":\"CfSneUS5\",\"前端基础_浏览器_浏览器渲染机制.md\":\"P-uyARdO\",\"前端基础_适配_页面适配.md\":\"DWCI7D2t\",\"前端基础_适配_pc适配.md\":\"BqIEWLyl\",\"前端工程化_代码规范_eslint_prettier.md\":\"BoKN8jrR\",\"前端工程化_代码规范_husky约束commit规范.md\":\"t38X3Zni\",\"前端工程化_开发_git使用.md\":\"BbSyBERE\",\"前端工程化_开发_npm使用.md\":\"0k1yIU7z\",\"前端工程化_开发_pnpm介绍.md\":\"BC-a4rwn\",\"前端工程化_开发_vscode快捷键和终端指令.md\":\"5AJ653A7\",\"前端工程化_开发_常用vscode插件.md\":\"CQ5mt-V2\",\"前端工程化_开发_脚手架_commander使用.md\":\"DV4A4ZkR\",\"前端工程化_开发_脚手架_搭建脚手架.md\":\"DOFLVj4D\",\"前端工程化_构建_babel_polyfill浏览器兼容.md\":\"BmVcv-HW\",\"前端工程化_构建_vite_catalog.md\":\"UaB_acwI\",\"前端工程化_构建_babel7.md\":\"CkCxgA_v\",\"前端工程化_构建_vite_plugin-legacy插件.md\":\"7iEr4t5u\",\"前端工程化_构建_vite_vite为何冷启动、热更快.md\":\"DUfDkY_2\",\"前端工程化_构建_vite_什么是预构建.md\":\"Bi5ZOVjM\",\"前端工程化_构建_vite_构建拆包.md\":\"CLxxZK6F\",\"前端工程化_构建_vite_插件.md\":\"Cl11z_7H\",\"前端工程化_构建_webpack_loader.md\":\"Dz92yFLb\",\"前端工程化_构建_webpack_介绍.md\":\"qIFQXgVq\",\"前端工程化_构建_webpack_热更新原理.md\":\"HsSdInwI\",\"前端工程化_测试_端到端测试.md\":\"CJu5TDH9\",\"前端工程化_部署_docker使用说明.md\":\"Dpmvw_KF\",\"前端工程化_部署_gitlab-ci.md\":\"C_x5x6-k\",\"前端工程化_部署_nginx指南.md\":\"el9ScNMx\",\"前端工程化_部署_node自动化部署.md\":\"Mitiy8zl\",\"前端性能优化_如何提升用户体验.md\":\"C3Tjayob\",\"前端性能优化_webpack打包优化.md\":\"B80t2yyA\",\"前端性能优化_性能优化.md\":\"lulLRojx\",\"前端架构_大仓库_lerna.md\":\"CGl0efGR\",\"前端架构_对bff的理解.md\":\"Do0UycBe\",\"前端架构_跨平台方案.md\":\"CNRqrszX\",\"前端架构_函数式编程.md\":\"DTtYXk69\",\"前端框架_nuxt_nuxt服务端渲染.md\":\"DjTL8aLj\",\"前端框架_ts_介绍.md\":\"CsaIzDVw\",\"前端框架_ts_实战.md\":\"WH7XQa3l\",\"前端框架_ts_常用配置.md\":\"BRkPwFzx\",\"前端框架_ts_编写声明文件.md\":\"DXYP7GW3\",\"前端框架_ts_类型工具.md\":\"DTzn8AH2\",\"前端框架_vue2_vue中key的作用.md\":\"BCyb7L5v\",\"前端框架_vue2_vue中的渲染函数_jsx.md\":\"BNdUDIR6\",\"前端框架_vue2_vue和react横向对比.md\":\"BERsYfri\",\"前端框架_vue2_vue-cli使用说明.md\":\"B3P7AWaQ\",\"前端框架_vue2_vui_static_temp_readme.md\":\"DtiLmfXO\",\"前端框架_ts_类型.md\":\"1i-X4xzY\",\"前端框架_vue2_vue高级特性.md\":\"BfjuVAcE\",\"前端框架_vue2_vue组件.md\":\"DOVdXrNr\",\"前端框架_vue3_vue3开发注意事项.md\":\"BIfu7NCG\",\"前端框架_vue3_vue3设计和原理_vue3做了哪些优化.md\":\"BMnUDmao\",\"前端框架_vue2_vue原理.md\":\"D5cWtwkA\",\"前端框架_vue2_异步更新和nexttick.md\":\"B67veFIa\",\"前端框架_vue3_vue3设计和原理_reactive_proxy的工作原理.md\":\"BkvY2mjg\",\"前端框架_vue3_vue3设计和原理_reactive_ref原始值的响应式.md\":\"Dw_-VNAd\",\"前端框架_vue3_vue3设计和原理_computed实现.md\":\"Bnra5BJB\",\"前端框架_vue3_vue3快速上手.md\":\"CGXXSnXI\",\"前端框架_vue3_vue3设计和原理_reactive_响应系统的设计.md\":\"BtQpsaS3\",\"前端框架_vue3_vue3设计和原理_renderer_初始化组件实例过程.md\":\"BKw10QM1\",\"前端生态_库_vueuse快速上手.md\":\"DiO6V5c8\",\"前端框架_vue3_vue3设计和原理_renderer_组件渲染成dom的过程.md\":\"DhDgSHVf\",\"前端框架_vue3_vue3设计和原理_renderer_渲染器的设计.md\":\"CY7bq-5l\",\"前端进阶_安全_csp内容安全策略.md\":\"C4_yjSXD\",\"前端进阶_动画_css动画.md\":\"Dy1xMr-E\",\"前端进阶_安全_csrf和xss.md\":\"BhkD5Uuo\",\"前端进阶_安全_加密和签名.md\":\"C_z3qXz-\",\"前端生态_库_lodash常用函数.md\":\"BGgp34qJ\",\"生活_书籍_刻意练习.md\":\"_HeYGTnh\",\"生活_书籍_人生的智慧.md\":\"DwRj5ir6\",\"前端进阶_手写代码_写代码小技巧.md\":\"DBa7F4Wg\",\"生活_书籍_小狗钱钱.md\":\"CGNW2Kne\",\"生活_随想_催眠自己去跑步的文章.md\":\"_zCU-7-8\",\"生活_随想_小事记录.md\":\"YokCxuJo\",\"前端进阶_手写代码_js小技巧.md\":\"EUDVlAU4\",\"生活_积累_沟通.md\":\"Dpdr-Usb\",\"生活_积累_良句.md\":\"IkhymlaR\",\"生活_书籍_亲密关系.md\":\"D1y24NL6\",\"生活_书籍_超级闲聊术.md\":\"BuCNeKFL\",\"程序员储备_开发语言_markdown_demo_assets_test.md\":\"BFdACFWC\",\"生活_随想_零碎想法.md\":\"CgHsRC4Y\",\"生活_书籍_金字塔原理.md\":\"Dy1cHyMs\",\"生活_书籍_如何阅读一本书.md\":\"BaxltpKg\",\"生活_心理学_需求层次理论.md\":\"CfzZVAJI\",\"程序员储备_开发语言_markdown_markdown语法.md\":\"hkSqh0dF\",\"程序员储备_开发语言_shell脚本编写.md\":\"dQ4U8NuK\",\"程序员储备_正则_学习正则表达式.md\":\"C4WGr3qU\",\"程序员储备_算法_基础算法.md\":\"CGQkUHUj\",\"程序员储备_正则_正则mini书笔记.md\":\"cwOAxsIb\",\"前端进阶_手写代码_js代码片段.md\":\"t6i6r1Vy\",\"程序员储备_开发语言_markdown_markdown转html.md\":\"Mcm-Ny89\",\"网络请求_本地域名映射.md\":\"CJG1fp6d\",\"网络请求_http_http协议.md\":\"CgwAKNs6\",\"网络请求_跨域资源共享cors.md\":\"D-iCtvnk\",\"网络请求_跨域解决方案.md\":\"BuUuMq3q\",\"面试_html面试题.md\":\"XdHeaUM1\",\"面试_与面试官的较量.md\":\"BCQCRX0n\",\"面试_做好面试官.md\":\"TF45t4of\",\"程序员储备_设计模式_设计模式.md\":\"CvWUW3Aw\",\"程序员储备_算法_算法深入.md\":\"MpqqYEh1\",\"面试_学习规划.md\":\"BrEWfXHw\",\"面试_前端面试资源汇总.md\":\"BRsKn-zG\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"wfj blog\",\"description\":\"wfj的笔记\",\"base\":\"/document-library/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"前端基础\",\"link\":\"/前端基础/html/H5开发FAQ\"},{\"text\":\"面试\",\"link\":\"/面试/前端面试资源汇总\"}],\"sidebar\":{\"/前端基础/\":[{\"text\":\"html\",\"items\":[{\"text\":\"H5开发FAQ\",\"link\":\"/前端基础/html/H5开发FAQ\"}]},{\"text\":\"css\",\"items\":[{\"text\":\"盒模型及BFC\",\"link\":\"/前端基础/css/盒模型及BFC\"},{\"text\":\"面试题\",\"link\":\"/前端基础/css/面试题\"},{\"text\":\"有趣的css\",\"link\":\"/前端基础/css/有趣的css\"},{\"text\":\"自适应和响应式布局\",\"link\":\"/前端基础/css/自适应和响应式布局\"}]},{\"text\":\"js\",\"items\":[{\"text\":\"基础\",\"items\":[{\"text\":\"数据类型的判断\",\"link\":\"/前端基础/js/基础/数据类型/数据类型的判断\"},{\"text\":\"数据类型的转换\",\"link\":\"/前端基础/js/基础/数据类型/数据类型的转换\"},{\"text\":\"闭包\",\"link\":\"/前端基础/js/基础/闭包\"},{\"text\":\"事件循环\",\"link\":\"/前端基础/js/基础/事件循环\"},{\"text\":\"原型链\",\"link\":\"/前端基础/js/基础/原型链\"},{\"text\":\"this指向\",\"link\":\"/前端基础/js/基础/this指向\"}]},{\"text\":\"封装\",\"items\":[{\"text\":\"防抖与节流\",\"link\":\"/前端基础/js/封装/防抖与节流/\"},{\"text\":\"深拷贝\",\"link\":\"/前端基础/js/封装/深拷贝\"},{\"text\":\"数组扁平化\",\"link\":\"/前端基础/js/封装/数组扁平化\"}]},{\"text\":\"ES6\",\"items\":[{\"text\":\"ESM和CommonJS\",\"link\":\"/前端基础/js/ES6/ESM/ESM和CommonJS\"},{\"text\":\"Promise介绍和实现\",\"link\":\"/前端基础/js/ES6/Promise/介绍和实现\"},{\"text\":\"类\",\"link\":\"/前端基础/js/ES6/类\"},{\"text\":\"新特性\",\"link\":\"/前端基础/js/ES6/新特性\"}]}]}],\"/面试/\":[{\"text\":\"前端面试资源汇总\",\"link\":\"/面试/前端面试资源汇总\"},{\"text\":\"与面试官的较量\",\"link\":\"/面试/与面试官的较量\"},{\"text\":\"做好面试官\",\"link\":\"/面试/做好面试官\"},{\"text\":\"html面试题\",\"link\":\"/面试/html面试题\"},{\"text\":\"学习规划\",\"link\":\"/面试/学习规划\"}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>